{
  "available": {{ product.available }},
  "description": "{{ product.metafields.custom.short_description | replace: '"', '``' | replace: "'", "`" }}",
  "model_info": "{{ product.metafields.custom.model | replace: '"', '``' | replace: "'", "`"  }}",
  "featured_image": "{{ product.featured_image | image_url: width: '600' }}",
  "featured_image_alt": "{{ product.featured_image.alt | escape }}",
  "handle": "{{ product.handle }}",
  "colors": [{%- for color_option in product.options_by_name['Color'].values -%}"{{ color_option }}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}],
  "sizes": [{%- for size_option in product.options_by_name['Size'].values -%}"{{ size_option }}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}],
  "id": "{{ product.id }}",
  "images": [{%- for image in product.images -%}{ "height": "{{ image.height }}", "width": "{{ image.width }}", "alt": "{{ image.alt }}", "src": "{{ image | image_url: width: 800 }}", "aspect_ratio": "{{ image.aspect_ratio }}" }{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}],
  "price": {{ product.price }},
  "compare_at_price": {{ product.compare_at_price | default: false }},
  "options_with_values": [{%- for option in product.options_with_values -%}{ "name": "{{ option.name }}", "values": [{%- for value in option.values -%}"{{ value }}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}] }{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}],
  "price_money": "{{ product.price | money }}",
  "price_varies": {{ product.price_varies }},
  "compare_at_price_money": "{{ product.compare_at_price | money }}",
  "title": "{{ product.title }}",
  "url": "{{ product.url }}",
  "tags": [{%- for tag in product.tags -%}"{{ tag }}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}],
  "show_discount": {{ show_discount }},
  "variants": [
    {%- for variant in product.variants -%}
      {%- liquid
        assign discounted_price = variant.price
        assign discount_percentage_factor = 100 | minus: settings.discount_percentage | divided_by: 100.00
        assign on_sale = false 
        if variant.compare_at_price > variant.price
          assign on_sale = true 
        endif

        if show_discount
          if discount_percentage > 0
            assign discounted_price = discounted_price | times: discount_percentage_factor | round
          elsif discount_price > 0 and discount_price < discounted_price
            assign discounted_price = discounted_price | minus: discount_price
          endif
        endif
      -%}
      {
        "default_selected": {%- if product.selected_or_first_available_variant.id == variant.id -%}true{%- else -%}false{%- endif -%},
        "available": {{ variant.available }},
        "inventory_policy":{%- if variant.inventory_policy == 'continue' -%}true{%- else -%}false{%- endif -%},
        "on_sale": {{ on_sale }},
        "id": "{{ variant.id }}",
        "compare_at_price": {{ variant.compare_at_price | default: false }},
        "compare_at_price_money": "{{ variant.compare_at_price | money }}",
        "discounted_price": "{{ discounted_price | money }}",
        "price": {{ variant.price }},
        "price_money": "{{ variant.price | money }}",
        "url": "{{ variant.url }}",
        "title": "{{ variant.title }}",
        "quantity": "{{ variant.inventory_quantity }}",
        {%- if variant.image -%}"image": { "alt": "{{ variant.image.alt }}", "src": "{{ variant.image | image_url: width: '800' }}" },{%- endif -%}
        "options": [{%- for option in variant.options -%}"{{ option }}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}]
      }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ]
}



